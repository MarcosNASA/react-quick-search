import * as React from "react";

import styled, { keyframes } from "styled-components";
import { colors } from "../../colors";
import placeholder from "../../assets/images/placeholder.png";

function ImageWithFallback({ src, alt, ...props }) {
  const [imageSrc, setImageSrc] = React.useState(src);
  const altFallback = imageSrc !== placeholder ? src : "Placeholder";

  const handleError = () => {
    setImageSrc(placeholder);
  };

  return (
    <img src={imageSrc} alt={altFallback} {...props} onError={handleError} />
  );
}
const BookImage = styled(ImageWithFallback)`
  object-fit: cover;
`;
const BookInfo = styled.div`
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: repeat(auto-fit, minmax(9px, auto));
`;
const BookTitle = styled.p`
  margin: 0px 8px 8px 16px;
  font-size: 14px;
  font-weight: 700;
  color: ${colors.grey800};
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
`;
const BookData = styled.p`
  margin: 4px 8px 0px 16px;
  font-size: 14px;
  align-self: flex-end;
  color: ${colors.grey600};
  overflow: hidden;
  text-overflow: ellipsis;
`;
const BuyInfo = styled(BookData)`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: flex-end;
  overflow: visible;
  text-overflow: ellipsis;
`;

function ItemInfo({ isbn, title, author, subject, price, image }) {
  return (
    <>
      <BookImage
        src={image}
        alt={`${title}'s cover`}
        height="96px"
        width="96px"
      ></BookImage>
      <BookInfo>
        <BookTitle>{title}</BookTitle>
        <BookData>{author}</BookData>
        <BookData>{subject}</BookData>
        <BuyInfo>
          {price}$
          <a
            href={`https://www.amazon.com/s?k=${isbn}`}
            target="_blank"
            rel="noreferrer"
          >
            Search on Amazon
          </a>
        </BuyInfo>
      </BookInfo>
    </>
  );
}

const NoItems = styled.p`
  font-size: 12px;
  padding: 10px;
`;

const placeholderAnimation = keyframes`
  0% {
    opacity: .5;
  }
  50% {
    opacity: 1;
  }
  100% {
    opacity: .5;
  }
`;
const PlaceholderImage = styled(BookImage)`
  animation: ${placeholderAnimation} 2s ease-in-out infinite;
`;
const PlaceholderBookTitle = styled(BookTitle)`
  height: 19px;
  background-color: ${colors.grey300};
  animation: ${placeholderAnimation} 2s ease-in-out infinite;
`;
const PlaceholderBookData = styled(BookData)`
  margin-top: 8px;
  height: 15px;
  background-color: ${colors.grey300};
  animation: ${placeholderAnimation} 2s ease-in-out infinite;
`;
function PlaceholderItemInfo() {
  return (
    <>
      <PlaceholderImage
        src={placeholder}
        alt="Placeholder"
        height="96px"
        width="96px"
      ></PlaceholderImage>
      <BookInfo>
        <PlaceholderBookTitle />
        <PlaceholderBookData />
        <PlaceholderBookData />
        <PlaceholderBookData />
      </BookInfo>
    </>
  );
}

const ErrorMessage = styled.p`
  color: ${colors.danger};
`;
ErrorMessage.defaultProps = {
  role: "alert",
};

const spinnerAnimation = keyframes`
  0% {
    transform: rotateZ(0deg);
  }
  100% {
    transform: rotateZ(360deg)
  }
`;
const circleAnimation = keyframes`
  0%,
  25% {
    stroke-dashoffset: 280;
    transform: rotate(0);
  }
  
  50%,
  75% {
    stroke-dashoffset: 75;
    transform: rotate(45deg);
  }
  
  100% {
    stroke-dashoffset: 280;
    transform: rotate(360deg);
  }
`;
const SpinnerSVG = styled.svg`
  animation: 2s linear infinite ${spinnerAnimation};
  & circle {
    animation: 1.4s ease-in-out infinite both ${circleAnimation};
    display: block;
    fill: transparent;
    stroke: #000;
    stroke-linecap: round;
    stroke-dasharray: 283;
    stroke-dashoffset: 280;
    stroke-width: 2px;
    transform-origin: 50% 50%;
  }
`;
const Spinner = () => (
  <SpinnerSVG width="32" height="32" viewBox="0 0 20 20" fill="none">
    <circle cx="10" cy="10" r="5" stroke="black" strokeWidth="2" />
  </SpinnerSVG>
);
Spinner.defaultProps = {
  "aria-label": "loading",
};

const SearchSVG = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="32"
    height="32"
    viewBox="0 0 20 20"
    fill="none"
  >
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M10.2942 5.26796C11.3988 7.18113 10.7433 9.62749 8.83013 10.7321C6.91696 11.8366 4.47059 11.1811 3.36603 9.26796C2.26146 7.35479 2.91696 4.90843 4.83013 3.80386C6.7433 2.69929 9.18966 3.35479 10.2942 5.26796ZM10.4806 10.6867C11.9477 9.12122 12.2885 6.72209 11.1603 4.76796C9.77954 2.3765 6.72159 1.55712 4.33013 2.93784C1.93866 4.31855 1.11929 7.3765 2.5 9.76796C3.62821 11.7221 5.87631 12.6265 7.96558 12.1387C8.0948 12.2514 8.2391 12.3141 8.34996 12.3546C8.43434 12.3854 8.52403 12.4115 8.60011 12.4337L8.6072 12.4358C8.68993 12.46 8.76511 12.482 8.8418 12.5086C9.11904 12.6049 9.4243 12.7612 9.69676 13.2331L9.69959 13.238L9.7008 13.2401L9.70263 13.2433L9.70481 13.2471L9.70565 13.2485L9.70866 13.2537L9.70877 13.2539L9.71165 13.2589L9.71269 13.2607L9.71463 13.2641L9.71658 13.2674L9.71759 13.2692L9.72043 13.2741L9.72053 13.2743L9.72345 13.2794L9.72424 13.2807L9.72636 13.2844L9.728 13.2872L9.72926 13.2894L9.73174 13.2937L9.73213 13.2944L9.73499 13.2993L9.73543 13.3001L9.73783 13.3043L9.73908 13.3064L9.74065 13.3091L9.7427 13.3127L9.74346 13.314L9.74625 13.3188L9.74628 13.3189L9.74902 13.3236L9.74982 13.325L9.75177 13.3284L9.75332 13.3311L9.75451 13.3331L9.75678 13.3371L9.75723 13.3378L9.75992 13.3425L9.76021 13.343L9.76261 13.3472L9.7636 13.3489L9.76527 13.3518L9.76695 13.3547L9.76792 13.3564L9.77026 13.3604L9.77054 13.3609L9.77315 13.3654L9.77354 13.3661L9.77574 13.3699L9.77678 13.3717L9.77832 13.3744L9.77998 13.3773L9.78087 13.3788L9.78314 13.3827L9.7834 13.3832L9.78592 13.3875L9.78627 13.3882L9.78842 13.3919L9.78936 13.3935L9.79089 13.3962L9.79242 13.3988L9.79335 13.4004L9.79543 13.404L9.79579 13.4046L9.79821 13.4088L9.79841 13.4092L9.80061 13.413L9.80136 13.4143L9.803 13.4171L9.80426 13.4193L9.80536 13.4212L9.80713 13.4243L9.8077 13.4253L9.80997 13.4292L9.81002 13.4293L9.81233 13.4333L9.81276 13.434L9.81461 13.4372L9.81553 13.4388L9.81687 13.4412L9.81825 13.4435L9.81912 13.445L9.82094 13.4482L9.82134 13.4489L9.82354 13.4527L9.82359 13.4528L9.82573 13.4565L9.82621 13.4573L9.82789 13.4602L9.82879 13.4618L9.83003 13.4639L9.83134 13.4662L9.83215 13.4676L9.83385 13.4706L9.83425 13.4713L9.83633 13.4749L9.83839 13.4784L9.83877 13.4791L9.84043 13.482L9.84117 13.4832L9.84244 13.4854L9.84354 13.4874L9.84444 13.4889L9.84588 13.4914L9.84641 13.4923L9.84818 13.4954L9.84837 13.4957L9.8503 13.499L9.85044 13.4993L9.85221 13.5024L9.85267 13.5032L9.85409 13.5056L9.85487 13.507L9.85596 13.5089L9.85703 13.5107L9.85781 13.5121L9.85915 13.5144L9.85963 13.5152L9.86124 13.518L9.86143 13.5183L9.86321 13.5214L9.8633 13.5216L9.86497 13.5245L9.86532 13.5251L9.8667 13.5275L9.86731 13.5285L9.86841 13.5304L9.86927 13.5319L9.8701 13.5334L9.87119 13.5352L9.87177 13.5362L9.87307 13.5385L9.87342 13.5391L9.87493 13.5417L9.87504 13.5419L9.87664 13.5447L9.87675 13.5449L9.87821 13.5474L9.87853 13.548L9.87977 13.5501L9.88028 13.551L9.8813 13.5527L9.882 13.554L9.88281 13.5554L9.88369 13.5569L9.88429 13.5579L9.88534 13.5597L9.88575 13.5605L9.88696 13.5625L9.88719 13.5629L9.88854 13.5653L9.8886 13.5654L9.88999 13.5678L9.89009 13.568L9.89136 13.5702L9.89161 13.5706L9.8927 13.5725L9.8931 13.5732L9.89402 13.5748L9.89455 13.5757L9.89532 13.577L9.89597 13.5782L9.89659 13.5792L9.89736 13.5806L9.89784 13.5814L9.89872 13.5829L9.89906 13.5835L9.90004 13.5852L9.90026 13.5856L9.90133 13.5874L9.90143 13.5876L9.90258 13.5896L9.90259 13.5896L9.90371 13.5916L9.90382 13.5918L9.90481 13.5935L9.90502 13.5938L9.90588 13.5953L9.90618 13.5958L9.90694 13.5972L9.90731 13.5978L9.90796 13.5989L9.90841 13.5997L9.90896 13.6007L9.90948 13.6016L9.90994 13.6024L9.91051 13.6033L9.91089 13.604L9.91152 13.6051L9.91181 13.6056L9.91249 13.6068L9.91271 13.6072L9.91343 13.6084L9.91359 13.6087L9.91434 13.61L9.91444 13.6101L9.91522 13.6115L9.91526 13.6116L9.91606 13.613L9.91607 13.613L9.91683 13.6143L9.91689 13.6144L9.91758 13.6156L9.91768 13.6158L9.9183 13.6168L9.91843 13.6171L9.91899 13.618L9.91916 13.6183L9.91966 13.6192L9.91985 13.6195L9.9203 13.6203L9.92052 13.6207L9.92092 13.6214L9.92115 13.6218L9.9215 13.6224L9.92176 13.6228L9.92207 13.6234L9.92233 13.6238L9.9226 13.6243L9.92287 13.6248L9.92311 13.6252L9.92339 13.6256L9.92359 13.626L9.92387 13.6265L9.92405 13.6268L9.92432 13.6273L9.92448 13.6275L9.92475 13.628L9.92488 13.6282L9.92514 13.6287L9.92525 13.6289L9.9255 13.6293L9.9256 13.6295L9.92584 13.6299L9.92592 13.63L9.92614 13.6304L9.92621 13.6305L9.92642 13.6309L9.92647 13.631L9.92667 13.6313L9.92671 13.6314L9.92688 13.6317L9.92692 13.6318L9.92707 13.632L9.9271 13.6321L9.92723 13.6323L9.92725 13.6323L9.92736 13.6325L9.92738 13.6326L9.92746 13.6327L9.92748 13.6327L9.92754 13.6328L9.92754 13.6328L9.92758 13.6329L9.92759 13.6329L9.9276 13.6329L10.8971 15.3122L11.7631 14.8122L10.7936 13.1329L10.7936 13.1329L10.7936 13.1329L10.7936 13.1328L10.7936 13.1328L10.7935 13.1327L10.7935 13.1327L10.7934 13.1326L10.7934 13.1325L10.7933 13.1323L10.7933 13.1323L10.7931 13.1321L10.7931 13.132L10.7929 13.1318L10.7929 13.1317L10.7927 13.1314L10.7927 13.1313L10.7925 13.131L10.7924 13.1309L10.7922 13.1305L10.7922 13.1304L10.7919 13.13L10.7919 13.1299L10.7916 13.1295L10.7915 13.1293L10.7913 13.1289L10.7912 13.1287L10.7909 13.1282L10.7908 13.128L10.7905 13.1275L10.7903 13.1273L10.7901 13.1268L10.7899 13.1265L10.7896 13.126L10.7894 13.1256L10.7891 13.1252L10.7889 13.1248L10.7886 13.1243L10.7884 13.1238L10.7881 13.1234L10.7878 13.1228L10.7875 13.1224L10.7872 13.1218L10.7869 13.1214L10.7865 13.1207L10.7863 13.1203L10.7859 13.1195L10.7857 13.1192L10.7852 13.1183L10.785 13.118L10.7845 13.1171L10.7843 13.1168L10.7837 13.1158L10.7836 13.1156L10.7829 13.1144L10.7829 13.1143L10.7821 13.113L10.7821 13.113L10.7813 13.1116L10.7812 13.1115L10.7805 13.1101L10.7804 13.11L10.7796 13.1087L10.7795 13.1084L10.7787 13.1072L10.7785 13.1068L10.7778 13.1056L10.7775 13.1051L10.7769 13.104L10.7765 13.1033L10.776 13.1024L10.7755 13.1016L10.775 13.1007L10.7744 13.0997L10.774 13.0989L10.7733 13.0978L10.773 13.0972L10.7722 13.0958L10.7719 13.0953L10.771 13.0938L10.7708 13.0935L10.7698 13.0918L10.7697 13.0916L10.7686 13.0896L10.7686 13.0896L10.7675 13.0876L10.7674 13.0874L10.7663 13.0856L10.7661 13.0852L10.7651 13.0835L10.7647 13.0829L10.7639 13.0814L10.7634 13.0806L10.7626 13.0792L10.762 13.0782L10.7613 13.077L10.7606 13.0757L10.76 13.0748L10.7591 13.0732L10.7587 13.0725L10.7576 13.0706L10.7574 13.0702L10.7561 13.068L10.756 13.0678L10.7546 13.0654L10.7546 13.0653L10.7532 13.0629L10.753 13.0625L10.7518 13.0605L10.7514 13.0597L10.7503 13.0579L10.7497 13.0569L10.7488 13.0554L10.748 13.054L10.7473 13.0527L10.7463 13.051L10.7458 13.0501L10.7446 13.048L10.7442 13.0474L10.7428 13.0449L10.7427 13.0447L10.7411 13.0419L10.741 13.0417L10.7394 13.0391L10.7391 13.0385L10.7378 13.0362L10.7372 13.0352L10.7361 13.0334L10.7353 13.0319L10.7344 13.0304L10.7333 13.0285L10.7327 13.0275L10.7313 13.0251L10.731 13.0245L10.7293 13.0216L10.7292 13.0214L10.7275 13.0183L10.7273 13.018L10.7257 13.0152L10.7252 13.0144L10.7238 13.0121L10.7231 13.0107L10.722 13.0089L10.7209 13.007L10.7201 13.0056L10.7187 13.0032L10.7182 13.0024L10.7165 12.9993L10.7163 12.999L10.7144 12.9957L10.7142 12.9954L10.7124 12.9923L10.7119 12.9914L10.7105 12.9889L10.7096 12.9874L10.7085 12.9854L10.7072 12.9832L10.7065 12.982L10.7048 12.9791L10.7044 12.9784L10.7024 12.9749L10.7003 12.9713L10.6999 12.9706L10.6982 12.9676L10.6974 12.9662L10.6961 12.9639L10.6948 12.9618L10.6939 12.9602L10.6922 12.9573L10.6918 12.9565L10.6896 12.9528L10.6896 12.9527L10.6874 12.9489L10.687 12.9482L10.6851 12.945L10.6843 12.9435L10.6829 12.9412L10.6816 12.9388L10.6806 12.9372L10.6788 12.934L10.6784 12.9333L10.6761 12.9293L10.676 12.9292L10.6737 12.9253L10.6732 12.9243L10.6714 12.9212L10.6703 12.9193L10.669 12.9171L10.6674 12.9143L10.6666 12.913L10.6644 12.9092L10.6642 12.9088L10.6618 12.9046L10.6615 12.904L10.6594 12.9004L10.6584 12.8988L10.6569 12.8962L10.6554 12.8935L10.6544 12.8919L10.6523 12.8882L10.6519 12.8875L10.6494 12.8832L10.6492 12.8827L10.6469 12.8788L10.646 12.8773L10.6443 12.8744L10.6428 12.8717L10.6418 12.8699L10.6396 12.8661L10.6392 12.8654L10.6366 12.8609L10.6363 12.8604L10.6339 12.8564L10.633 12.8547L10.6313 12.8518L10.6296 12.8489L10.6286 12.8472L10.6262 12.843L10.626 12.8425L10.6233 12.8378L10.6228 12.8371L10.6205 12.8331L10.6193 12.8311L10.6178 12.8284L10.6158 12.825L10.615 12.8236L10.6123 12.8189L10.6123 12.8188L10.6095 12.814L10.6087 12.8127L10.6067 12.8091L10.6051 12.8064L10.6039 12.8043L10.6015 12.8001L10.601 12.7993L10.5982 12.7944L10.5978 12.7937L10.5953 12.7894L10.594 12.7872L10.5924 12.7844L10.5903 12.7807L10.5895 12.7794L10.5866 12.7743L10.5865 12.7741L10.5836 12.7692L10.5826 12.7674L10.5807 12.7641L10.5787 12.7607L10.5777 12.7589L10.5748 12.7539L10.5747 12.7537L10.5717 12.7485L10.5708 12.7471L10.5687 12.7433L10.5668 12.7401L10.5656 12.738L10.5628 12.7331C10.2903 12.2612 10.3076 11.9187 10.3628 11.6305C10.3781 11.5507 10.3966 11.4746 10.4171 11.3909L10.4188 11.3837C10.4376 11.3067 10.4598 11.216 10.4753 11.1275C10.4957 11.0112 10.5136 10.8549 10.4806 10.6867Z"
      fill="black"
    />
  </svg>
);
SearchSVG.defaultProps = {
  "aria-label": "Search",
};
const ErrorSVG = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="32"
    height="32"
    viewBox="0 0 20 20"
    fill="none"
  >
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M6 12C9.31372 12 12 9.31372 12 6C12 2.68628 9.31372 0 6 0C2.68628 0 0 2.68628 0 6C0 9.31372 2.68628 12 6 12ZM2.81802 3.52512L5.29288 6L2.81802 8.47488L3.52512 9.18198L6 6.70709L8.47485 9.18198L9.18198 8.47488L6.70709 6L9.18198 3.52512L8.47485 2.81802L6 5.29291L3.52512 2.81802L2.81802 3.52512Z"
      fill="black"
    />
  </svg>
);

const SearchInputIcon = styled.i`
  grid-area: 1 / 2 / 2 / 3;
  align-self: center;
  justify-self: center;
  display: grid;
  place-items: center;
  height: 100%;
  width: 100%;
`;
const SpinnerIcon = styled(Spinner)``;
SpinnerIcon.displayName = "SpinnerIcon";
const SearchIcon = styled(SearchSVG)``;
SearchIcon.displayName = "SearchIcon";
const ErrorIcon = styled(ErrorSVG)``;
ErrorIcon.displayName = "ErrorIcon";

export {
  SearchInputIcon,
  SpinnerIcon,
  SearchIcon,
  ErrorIcon,
  ImageWithFallback,
  BookImage,
  BookTitle,
  BookData,
  BuyInfo,
  ItemInfo,
  PlaceholderImage,
  PlaceholderBookTitle,
  PlaceholderBookData,
  PlaceholderItemInfo,
  NoItems,
  ErrorMessage,
};
